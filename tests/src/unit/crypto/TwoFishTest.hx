package unit.crypto;

import unit.Test;
import haxe.Timer;
import haxe.io.Bytes;
import haxe.crypto.TwoFish;
import haxe.crypto.mode.Mode;
import haxe.crypto.padding.*;

class TwoFishTest extends Test {
	var keys = [
		"00000000000000000000000000000000",
		"0123456789ABCDEFFEDCBA98765432100011223344556677",
		"0123456789ABCDEFFEDCBA987654321000112233445566778899AABBCCDDEEFF",
		"00000000000000000000000000000000",
		"9F589F5CF6122C32B6BFEC2F2AE8C35A",
		"D491DB16E7B1C39E86CB086B789F5419",
		"019F9809DE1711858FAAC3A3BA20FBC3",
		"6363977DE839486297E661C6C9D668EB",
		"816D5BD0FAE35342BF2A7412C246F752",
		"5449ECA008FF5921155F598AF4CED4D0",
		"6600522E97AEB3094ED5F92AFCBCDD10",
		"34C8A5FB2D3D08A170D120AC6D26DBFA",
		"137A24CA47CD12BE818DF4D2F4355960",
		"BCA724A54533C6987E14AA827952F921",
		"000000000000000000000000000000000000000000000000",
		"000000000000000000000000000000000000000000000000",
		"EFA71F788965BD4453F860178FC191010000000000000000",
		"88B2B2706B105E36B446BB6D731A1E88EFA71F788965BD44",
		"39DA69D6BA4997D585B6DC073CA341B288B2B2706B105E36",
		"182B02D81497EA45F9DAACDC29193A6539DA69D6BA4997D5",
		"7AFF7A70CA2FF28AC31DD8AE5DAAAB63182B02D81497EA45",
		"D1079B789F666649B6BD7D1629F1F77E7AFF7A70CA2FF28A",
		"3AF6F7CE5BD35EF18BEC6FA787AB506BD1079B789F666649",
		"AE8109BFDA85C1F2C5038B34ED691BFF3AF6F7CE5BD35EF1",
		"DEA4F3DA75EC7A8EAC3861A9912402CD5DBE44032769DF54",
		"FB66522C332FCC4C042ABE32FA9E902FDEA4F3DA75EC7A8E",
		"0000000000000000000000000000000000000000000000000000000000000000",
		"0000000000000000000000000000000000000000000000000000000000000000",
		"57FF739D4DC92C1BD7FC01700CC8216F00000000000000000000000000000000",
		"D43BB7556EA32E46F2A282B7D45B4E0D57FF739D4DC92C1BD7FC01700CC8216F",
		"90AFE91BB288544F2C32DC239B2635E6D43BB7556EA32E46F2A282B7D45B4E0D",
		"6CB4561C40BF0A9705931CB6D408E7FA90AFE91BB288544F2C32DC239B2635E6",
		"3059D6D61753B958D92F4781C8640E586CB4561C40BF0A9705931CB6D408E7FA",
		"E69465770505D7F80EF68CA38AB3A3D63059D6D61753B958D92F4781C8640E58",
		"5AB67A5F8539A4A5FD9F0373BA463466E69465770505D7F80EF68CA38AB3A3D6",
		"DC096BCD99FC72F79936D4C748E75AF75AB67A5F8539A4A5FD9F0373BA463466",
		"2E2158BC3E5FC714C1EEECA0EA696D48D2DED73E59319A8138E0331F0EA149EA",
		"248A7F3528B168ACFDD1386E3F51E30C2E2158BC3E5FC714C1EEECA0EA696D48"
	];
	var plainText = [
		"00000000000000000000000000000000",
		"00000000000000000000000000000000",
		"00000000000000000000000000000000",
		"9F589F5CF6122C32B6BFEC2F2AE8C35A",
		"D491DB16E7B1C39E86CB086B789F5419",
		"019F9809DE1711858FAAC3A3BA20FBC3",
		"6363977DE839486297E661C6C9D668EB",
		"816D5BD0FAE35342BF2A7412C246F752",
		"5449ECA008FF5921155F598AF4CED4D0",
		"6600522E97AEB3094ED5F92AFCBCDD10",
		"34C8A5FB2D3D08A170D120AC6D26DBFA",
		"28530B358C1B42EF277DE6D4407FC591",
		"BCA724A54533C6987E14AA827952F921",
		"6B459286F3FFD28D49F15B1581B08E42",
		"00000000000000000000000000000000",
		"EFA71F788965BD4453F860178FC19101",
		"88B2B2706B105E36B446BB6D731A1E88",
		"39DA69D6BA4997D585B6DC073CA341B2",
		"182B02D81497EA45F9DAACDC29193A65",
		"7AFF7A70CA2FF28AC31DD8AE5DAAAB63",
		"D1079B789F666649B6BD7D1629F1F77E",
		"3AF6F7CE5BD35EF18BEC6FA787AB506B",
		"AE8109BFDA85C1F2C5038B34ED691BFF",
		"893FD67B98C550073571BD631263FC78",
		"FB66522C332FCC4C042ABE32FA9E902F",
		"F0AB73301125FA21EF70BE5385FB76B6",
		"00000000000000000000000000000000",
		"57FF739D4DC92C1BD7FC01700CC8216F",
		"D43BB7556EA32E46F2A282B7D45B4E0D",
		"90AFE91BB288544F2C32DC239B2635E6",
		"6CB4561C40BF0A9705931CB6D408E7FA",
		"3059D6D61753B958D92F4781C8640E58",
		"E69465770505D7F80EF68CA38AB3A3D6",
		"5AB67A5F8539A4A5FD9F0373BA463466",
		"DC096BCD99FC72F79936D4C748E75AF7",
		"C5A3E7CEE0F1B7260528A68FB4EA05F2",
		"248A7F3528B168ACFDD1386E3F51E30C",
		"431058F4DBC7F734DA4F02F04CC4F459"
	];
	var ecb_ciphers = [
		"9F589F5CF6122C32B6BFEC2F2AE8C35A",
		"CFD1D2E5A9BE9CDF501F13B892BD2248",
		"37527BE0052334B89F0CFCCAE87CFA20",
		"D491DB16E7B1C39E86CB086B789F5419",
		"019F9809DE1711858FAAC3A3BA20FBC3",
		"6363977DE839486297E661C6C9D668EB",
		"816D5BD0FAE35342BF2A7412C246F752",
		"5449ECA008FF5921155F598AF4CED4D0",
		"6600522E97AEB3094ED5F92AFCBCDD10",
		"34C8A5FB2D3D08A170D120AC6D26DBFA",
		"28530B358C1B42EF277DE6D4407FC591",
		"8A8AB983310ED78C8C0ECDE030B8DCA4",
		"6B459286F3FFD28D49F15B1581B08E42",
		"5D9D4EEFFA9151575524F115815A12E0",
		"EFA71F788965BD4453F860178FC19101",
		"88B2B2706B105E36B446BB6D731A1E88",
		"39DA69D6BA4997D585B6DC073CA341B2",
		"182B02D81497EA45F9DAACDC29193A65",
		"7AFF7A70CA2FF28AC31DD8AE5DAAAB63",
		"D1079B789F666649B6BD7D1629F1F77E",
		"3AF6F7CE5BD35EF18BEC6FA787AB506B",
		"AE8109BFDA85C1F2C5038B34ED691BFF",
		"893FD67B98C550073571BD631263FC78",
		"16434FC9C8841A63D58700B5578E8F67",
		"F0AB73301125FA21EF70BE5385FB76B6",
		"E75449212BEEF9F4A390BD860A640941",
		"57FF739D4DC92C1BD7FC01700CC8216F",
		"D43BB7556EA32E46F2A282B7D45B4E0D",
		"90AFE91BB288544F2C32DC239B2635E6",
		"6CB4561C40BF0A9705931CB6D408E7FA",
		"3059D6D61753B958D92F4781C8640E58",
		"E69465770505D7F80EF68CA38AB3A3D6",
		"5AB67A5F8539A4A5FD9F0373BA463466",
		"DC096BCD99FC72F79936D4C748E75AF7",
		"C5A3E7CEE0F1B7260528A68FB4EA05F2",
		"43D5CEC327B24AB90AD34A79D0469151",
		"431058F4DBC7F734DA4F02F04CC4F459",
		"37FE26FF1CF66175F5DDF4C33B97A205"
	];

	private function twofish_main(ciphers:Array<String> = null, cipherMode:Mode = Mode.ECB, padding:Padding = Padding.NoPadding,
			ivTable:Array<String> = null):Void {
		if (ciphers == null)
			return;
		trace("Twofish with " + cipherMode + " mode for " + keys.length + " keys");
		var time = Timer.stamp();

		var twoFish:TwoFish = new TwoFish();

		for (i in 0...keys.length) {
			var key = Bytes.ofHex(keys[i]);
			var text = Bytes.ofHex(plainText[i]);
			var iv:Bytes = (ivTable == null) ? null : Bytes.ofHex(ivTable[i]);
			twoFish.init(key, iv);
			var enc = twoFish.encrypt(cipherMode, text, padding);
			eq(enc.toHex().toUpperCase(), ciphers[i]);
			var decr = twoFish.decrypt(cipherMode, enc, padding);
			eq(decr.toHex().toUpperCase(), plainText[i]);
		}

		time = Timer.stamp() - time;
		trace("Finished : " + time + " seconds");
	}

	public function test_ecb():Void {
		twofish_main(ecb_ciphers, Mode.ECB, Padding.NoPadding, null);
	}
}
