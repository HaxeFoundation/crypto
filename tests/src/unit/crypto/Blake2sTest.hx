package unit.crypto;

import unit.Test;
import haxe.Timer;
import haxe.io.Bytes;
import haxe.crypto.Blake2s;

class Blake2sTest extends Test {
	var inputs = [
		"",
		"00",
		"0001",
		"000102"
	];

	var inputKeys = [
		"",
		"00",
		"0001",
		"000102",
		"00010203",
		"0001020304050607",
		"000102030405060708090a",
		"000102030405060708090a0b0c0d0e0f",
		"000102030405060708090a0b0c0d0e0f101112",
		"000102030405060708090a0b0c0d0e0f101112131415",
		"000102030405060708090a0b0c0d0e0f101112131415161718",
		"000102030405060708090a0b0c0d0e0f101112131415161718191a1b",
		"000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e",
		"000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f",
		"000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f2021",
		"000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f2021222324",
		"000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f2021222324252627",
		"000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a",
		"000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d",
		"000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f",
		"000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f3031",
		"000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f30313233",
		"000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435",
		"000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f3031323334353637"
	];

	var hashes = [
		"69217a3079908094e11121d042354a7c1f55b6482ca1a51e1b250dfd1ed0eef9",
		"e34d74dbaf4ff4c6abd871cc220451d2ea2648846c7757fbaac82fe51ad64bea",
		"ddad9ab15dac4549ba42f49d262496bef6c0bae1dd342a8808f8ea267c6e210c",
		"e8f91c6ef232a041452ab0e149070cdd7dd1769e75b3a5921be37876c45c9900",
		];

	var keyHashes = [
		"48a8997da407876b3d79c0d92325ad3b89cbb754d86ab71aee047ad345fd2c49",
		"40d15fee7c328830166ac3f918650f807e7e01e177258cdc0a39b11f598066f1",
		"6bb71300644cd3991b26ccd4d274acd1adeab8b1d7914546c1198bbe9fc9d803",
		"1d220dbe2ee134661fdf6d9e74b41704710556f2f6e5a091b227697445dbea6b",
		"f6c3fbadb4cc687a0064a5be6e791bec63b868ad62fba61b3757ef9ca52e05b2",
		"19fc8ca6979d60e6edd3b4541e2f967ced740df6ec1eaebbfe813832e96b2974",
		"e33c4c9bd0cc7e45c80e65c77fa5997fec7002738541509e68a9423891e822a3",
		"19ba234f0a4f38637d1839f9d9f76ad91c8522307143c97d5f93f69274cec9a7",
		"f1b01558ce541262f5ec34299d6fb4090009e3434be2f49105cf46af4d2d4124",
		"20be1a875b38c573dd7faaa0de489d655c11efb6a552698e07a2d331b5f655c3",
		"110c50c0bf2c6e7aeb7e435d92d132ab6655168e78a2decdec3330777684d9c1",
		"213f3596d6e3a5d0e9932cd2159146015e2abc949f4729ee2632fe1edb78d337",
		"b6156f72d380ee9ea6acd190464f2307a5c179ef01fd71f99f2d0f7a57360aea",
		"c03bc642b20959cbe133a0303e0c1abff3e31ec8e1a328ec8565c36decff5265",
		"f738c02f3c1b190c512b1a32deabf353728e0e9ab034490e3c3409946a97aeec",
		"62bf8a9c32a5bccf290b6c474d75b2a2a4093f1a9e27139433a8f2b3bce7b8d7",
		"387d397ea43a994be84d2d544afbe481a2000f55252696bba2c50c8ebd101347",
		"877968686c068ce2f7e2adcff68bf8748edf3cf862cfb4d3947a3106958054e3",
		"f164abba4963a44d107257e3232d90aca5e66a1408248c51741e991db5227756",
		"03fbb16384f0a3866f4c3117877666efbf124597564b293d4aab0d269fabddfa",
		"cdfabcee46911111236a31708b2539d71fc211d9b09c0d8530a11e1dbf6eed01",
		"259ec7f173bcc76a0994c967b4f5f024c56057fb79c965c4fae41875f06a0e4c",
		"5c10896f0e2856b2a2eee0fe4a2c1633565d18f0e93e1fab26c373e8f829654d",
		"2966b3cfae1e44ea996dc5d686cf25fa053fb6f67201b9e46eade85d0ad6b806"
	];

	public function test():Void {
		trace("Blake2s for " + inputs.length + " inputs");
		var time = Timer.stamp();
		for (i in 0...inputs.length) {
			var input = Bytes.ofHex(inputs[i]);
			var hash = Blake2s.hash(input);
			eq(hash.toHex().toLowerCase(), hashes[i]);
		}
		time = Timer.stamp() - time;
		trace("Finished : " + time + " seconds");
	}

	public function testKeys():Void {
		trace("Blake2s key for " + inputKeys.length + " inputs");
		var key = Bytes.ofHex("000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f");
		var time = Timer.stamp();
		for (i in 0...inputKeys.length) {
			var input = Bytes.ofHex(inputKeys[i]);
			var hash = Blake2s.hash(input,32,key);
			eq(hash.toHex().toLowerCase(), keyHashes[i]);
		}
		time = Timer.stamp() - time;
		trace("Finished : " + time + " seconds");
	}
}
