package unit.crypto;

import unit.Test;
import haxe.Timer;
import haxe.io.Bytes;
import haxe.crypto.Aes;
import haxe.crypto.mode.Mode;
import haxe.crypto.padding.*;
import haxe.crypto.mode.CMAC;

class AesTest extends Test {
	var keys = [
		                                "2B7E151628AED2A6ABF7158809CF4F3C",                                 "2B7E151628AED2A6ABF7158809CF4F3C",
		                                "2B7E151628AED2A6ABF7158809CF4F3C",                               "2B7E151628AED2A6ABF7158809CF4F3C",
		                "8E73B0F7DA0E6452C810F32B809079E562F8EAD2522C6B7B",                 "8E73B0F7DA0E6452C810F32B809079E562F8EAD2522C6B7B",
		                "8E73B0F7DA0E6452C810F32B809079E562F8EAD2522C6B7B",               "8E73B0F7DA0E6452C810F32B809079E562F8EAD2522C6B7B",
		"603DEB1015CA71BE2B73AEF0857D77811F352C073B6108D72D9810A30914DFF4", "603DEB1015CA71BE2B73AEF0857D77811F352C073B6108D72D9810A30914DFF4",
		"603DEB1015CA71BE2B73AEF0857D77811F352C073B6108D72D9810A30914DFF4", "603DEB1015CA71BE2B73AEF0857D77811F352C073B6108D72D9810A30914DFF4"
	];

	var plainText = [
		"6BC1BEE22E409F96E93D7E117393172A", "AE2D8A571E03AC9C9EB76FAC45AF8E51", "30C81C46A35CE411E5FBC1191A0A52EF", "F69F2445DF4F9B17AD2B417BE66C3710",
		"6BC1BEE22E409F96E93D7E117393172A", "AE2D8A571E03AC9C9EB76FAC45AF8E51", "30C81C46A35CE411E5FBC1191A0A52EF", "F69F2445DF4F9B17AD2B417BE66C3710",
		"6BC1BEE22E409F96E93D7E117393172A", "AE2D8A571E03AC9C9EB76FAC45AF8E51", "30C81C46A35CE411E5FBC1191A0A52EF", "F69F2445DF4F9B17AD2B417BE66C3710"
	];

	var ecb_ciphers = [
		"3AD77BB40D7A3660A89ECAF32466EF97", "F5D3D58503B9699DE785895A96FDBAAF", "43B1CD7F598ECE23881B00E3ED030688", "7B0C785E27E8AD3F8223207104725DD4",
		"BD334F1D6E45F25FF712A214571FA5CC", "974104846D0AD3AD7734ECB3ECEE4EEF", "EF7AFD2270E2E60ADCE0BA2FACE6444E", "9A4B41BA738D6C72FB16691603C18E0E",
		"F3EED1BDB5D2A03C064B5A7E3DB181F8", "591CCB10D410ED26DC5BA74A31362870", "B6ED21B99CA6F4F9F153E7B1BEAFED1D", "23304B7A39F9F3FF067D8D8F9E24ECC7"
	];

	var cbc_iv = [
		"000102030405060708090A0B0C0D0E0F", "7649ABAC8119B246CEE98E9B12E9197D", "5086CB9B507219EE95DB113A917678B2", "73BED6B8E3C1743B7116E69E22229516",
		"000102030405060708090A0B0C0D0E0F", "4F021DB243BC633D7178183A9FA071E8", "B4D9ADA9AD7DEDF4E5E738763F69145A", "571B242012FB7AE07FA9BAAC3DF102E0",
		"000102030405060708090A0B0C0D0E0F", "F58C4C04D6E5F1BA779EABFB5F7BFBD6", "9CFC4E967EDB808D679F777BC6702C7D", "39F23369A9D9BACFA530E26304231461"
	];

	var cbc_ciphers = [
		"7649ABAC8119B246CEE98E9B12E9197D", "5086CB9B507219EE95DB113A917678B2", "73BED6B8E3C1743B7116E69E22229516", "3FF1CAA1681FAC09120ECA307586E1A7",
		"4F021DB243BC633D7178183A9FA071E8", "B4D9ADA9AD7DEDF4E5E738763F69145A", "571B242012FB7AE07FA9BAAC3DF102E0", "08B0E27988598881D920A9E64F5615CD",
		"F58C4C04D6E5F1BA779EABFB5F7BFBD6", "9CFC4E967EDB808D679F777BC6702C7D", "39F23369A9D9BACFA530E26304231461", "B2EB05E2C39BE9FCDA6C19078C6A9D1B"
	];

	var cfb_iv = [
		"000102030405060708090A0B0C0D0E0F", "3B3FD92EB72DAD20333449F8E83CFB4A", "C8A64537A0B3A93FCDE3CDAD9F1CE58B", "26751F67A3CBB140B1808CF187A4F4DF",
		"000102030405060708090A0B0C0D0E0F", "CDC80D6FDDF18CAB34C25909C99A4174", "67CE7F7F81173621961A2B70171D3D7A", "2E1E8A1DD59B88B1C8E60FED1EFAC4C9",
		"000102030405060708090A0B0C0D0E0F", "DC7E84BFDA79164B7ECD8486985D3860", "39FFED143B28B1C832113C6331E5407B", "DF10132415E54B92A13ED0A8267AE2F9"
	];

	var cfb_ciphers = [
		"3B3FD92EB72DAD20333449F8E83CFB4A", "C8A64537A0B3A93FCDE3CDAD9F1CE58B", "26751F67A3CBB140B1808CF187A4F4DF", "C04B05357C5D1C0EEAC4C66F9FF7F2E6",
		"CDC80D6FDDF18CAB34C25909C99A4174", "67CE7F7F81173621961A2B70171D3D7A", "2E1E8A1DD59B88B1C8E60FED1EFAC4C9", "C05F9F9CA9834FA042AE8FBA584B09FF",
		"DC7E84BFDA79164B7ECD8486985D3860", "39FFED143B28B1C832113C6331E5407B", "DF10132415E54B92A13ED0A8267AE2F9", "75A385741AB9CEF82031623D55B1E471"
	];

	var ofb_iv = [
		"000102030405060708090A0B0C0D0E0F", "50FE67CC996D32B6DA0937E99BAFEC60", "D9A4DADA0892239F6B8B3D7680E15674", "A78819583F0308E7A6BF36B1386ABF23",
		"000102030405060708090A0B0C0D0E0F", "A609B38DF3B1133DDDFF2718BA09565E", "52EF01DA52602FE0975F78AC84BF8A50", "BD5286AC63AABD7EB067AC54B553F71D",
		"000102030405060708090A0B0C0D0E0F", "B7BF3A5DF43989DD97F0FA97EBCE2F4A", "E1C656305ED1A7A6563805746FE03EDC", "41635BE625B48AFC1666DD42A09D96E7"
	];

	var ofb_ciphers = [
		"3B3FD92EB72DAD20333449F8E83CFB4A", "7789508D16918F03F53C52DAC54ED825", "9740051E9C5FECF64344F7A82260EDCC", "304C6528F659C77866A510D9C1D6AE5E",
		"CDC80D6FDDF18CAB34C25909C99A4174", "FCC28B8D4C63837C09E81700C1100401", "8D9A9AEAC0F6596F559C6D4DAF59A5F2", "6D9F200857CA6C3E9CAC524BD9ACC92A",
		"DC7E84BFDA79164B7ECD8486985D3860", "4FEBDC6740D20B3AC88F6AD82A4FB08D", "71AB47A086E86EEDF39D1C5BBA97C408", "0126141D67F37BE8538F5A8BE740E484"
	];
	
	// CMAC test vectors from RFC 4493
	var cmac_keys = [
		"2B7E151628AED2A6ABF7158809CF4F3C",
		"2B7E151628AED2A6ABF7158809CF4F3C",
		"2B7E151628AED2A6ABF7158809CF4F3C",
		"2B7E151628AED2A6ABF7158809CF4F3C",
		"8E73B0F7DA0E6452C810F32B809079E562F8EAD2522C6B7B"
	];

	var cmac_messages = [
		"",
		"6BC1BEE22E409F96E93D7E117393172A",
		"6BC1BEE22E409F96E93D7E117393172AAE2D8A571E03AC9C9EB76FAC45AF8E5130C81C46A35CE411",
		"6BC1BEE22E409F96E93D7E117393172AAE2D8A571E03AC9C9EB76FAC45AF8E5130C81C46A35CE411E5FBC1191A0A52EFF69F2445DF4F9B17AD2B417BE66C3710",
		"6BC1BEE22E409F96E93D7E117393172A"
	];

	var cmac_results = [
		"BB1D6929E95937287FA37D129B756746",
		"070A16B46B4D4144F79BDD9DD04A287C",
		"DFA66747DE9AE63030CA32611497C827",
		"51F0BEBF7E3B9D92FC49741779363CFE",
		"9E99A7BF31E710900662F65E617C5184"
	];

	// CCM test vectors from RFC 3610
	var ccm_keys = [
		"C0C1C2C3C4C5C6C7C8C9CACBCCCDCECF",
		"C0C1C2C3C4C5C6C7C8C9CACBCCCDCECF",
		"C0C1C2C3C4C5C6C7C8C9CACBCCCDCECF",
		"C0C1C2C3C4C5C6C7C8C9CACBCCCDCECF",
		"240EF4EC0A7B24017C13E461227D11F608C41698457E948F657D82A19D970544",
		"A01745F52F1F3564DA0ADF845FDBD47A5BD1865092579558F67F67BA07F238A0",
		"9415F925BCB41DC25E86C826DBC8BF68"
	];

	var ccm_nonces = [
		"00000003020100A0A1A2A3A4A5",
		"00000004030201A0A1A2A3A4A5",
		"00000005040302A0A1A2A3A4A5",
		"00000006050403A0A1A2A3A4A5",
		"52EC46F52781BB7CD00FBFD3",
		"87D7CEC6301B81E3E0666E27",
		"BDFFAA763B916FF0EE3F3CE4"
	];

	var ccm_aad = [
		"0001020304050607",
		"0001020304050607",
		"0001020304050607",
		"000102030405060708090A0B",
		"899C64ABBEC1468EC5B8427E61B990AB",
		"",
		"705D676CD8A94451"
	];

	var ccm_plaintexts = [
		"08090A0B0C0D0E0F101112131415161718191A1B1C1D1E",
		"08090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F",
		"08090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F20",
		"0C0D0E0F101112131415161718191A1B1C1D1E",
		"2B25882F824B41EAF4B2150EB1FE8DC0F9C7156A41881B39D13DAEC1F9B0B1",
		"D5C01280ACF0AFE77DF767FF3C028F52E3D3786A84CC7CC0070661A81C1FBD",
		"FEB36167EAFC02C8E2BD6E13817686BA"
	];

	var ccm_ciphers = [
		"588C979A61C663D2F066D0C2C0F989806D5F6B61DAC38417E8D12CFDF926E0",
		"72C91A36E135F8CF291CA894085C87E3CC15C439C9E43A3BA091D56E10400916",
		"51B1E5F44A197D1DA46B0F8E2D282AE871E838BB64DA8596574ADAA76FBD9FB0C5",
		"A28C6865939A9A79FAAA5C4C2A9D4A91CDAC8C96C861B9C9E61EF1",
		"E94E44B5E7BB26B249B48CAAF2A9AB5A7506FF39668FFEA6F62BB030FE5C871A859AA806260472A53979CC4EAA",
		"CB07FC5962F7D3268606F1D224FD92B3C2302620F03320784A71180D7265017F64EBEB84BCAD46347FF1F27447",
		"08DB327A88BE7B48F430FD7BFCCDF502B7C249F810ADACF99ABDED1F3B9130F2"
	];

	var ccm_tag_lengths = [8, 8, 8, 8, 14, 14, 16];

	// GCM test vectors from NIST SP 800-38D
	var gcm_keys = [
		"00000000000000000000000000000000",
		"00000000000000000000000000000000",
		"FEFFE9928665731C6D6A8F9467308308",
		"FEFFE9928665731C6D6A8F9467308308",
		"FEFFE9928665731C6D6A8F9467308308",
		"FEFFE9928665731C6D6A8F9467308308",
		"FEFFE9928665731C6D6A8F9467308308",
		"000000000000000000000000000000000000000000000000",
		"000000000000000000000000000000000000000000000000",
		"FEFFE9928665731C6D6A8F9467308308FEFFE9928665731C",
		"FEFFE9928665731C6D6A8F9467308308FEFFE9928665731C",
		"FEFFE9928665731C6D6A8F9467308308FEFFE9928665731C",
		"FEFFE9928665731C6D6A8F9467308308FEFFE9928665731C",
		"0000000000000000000000000000000000000000000000000000000000000000",
		"0000000000000000000000000000000000000000000000000000000000000000",
		"FEFFE9928665731C6D6A8F9467308308FEFFE9928665731C6D6A8F9467308308",
		"FEFFE9928665731C6D6A8F9467308308FEFFE9928665731C6D6A8F9467308308",
		"FEFFE9928665731C6D6A8F9467308308FEFFE9928665731C6D6A8F9467308308",
		"FEFFE9928665731C6D6A8F9467308308FEFFE9928665731C6D6A8F9467308308"
	];

	var gcm_ivs = [
		"000000000000000000000000",
		"000000000000000000000000",
		"CAFEBABEFACEDBADDECAF888",
		"CAFEBABEFACEDBADDECAF888",
		"CAFEBABEFACEDBAD",
		"9313225DF88406E555909C5AFF5269AA6A7A9538534F7DA1E4C303D2A318A728C3C0C95156809539FCF0E2429A6B525416AEDBF5A0DE6A57A637B39B",
		"9313225DF88406E555909C5AFF5269AA6A7A9538534F7DA1E4C303D2A318A728C3C0C95156809539FCF0E2429A6B525416AEDBF5A0DE6A57A637B39B",
		"000000000000000000000000",
		"000000000000000000000000",
		"CAFEBABEFACEDBADDECAF888",
		"CAFEBABEFACEDBADDECAF888",
		"CAFEBABEFACEDBAD",
		"9313225DF88406E555909C5AFF5269AA6A7A9538534F7DA1E4C303D2A318A728C3C0C95156809539FCF0E2429A6B525416AEDBF5A0DE6A57A637B39B",
		"000000000000000000000000",
		"000000000000000000000000",
		"CAFEBABEFACEDBADDECAF888",
		"CAFEBABEFACEDBADDECAF888",
		"CAFEBABEFACEDBAD",
		"9313225DF88406E555909C5AFF5269AA6A7A9538534F7DA1E4C303D2A318A728C3C0C95156809539FCF0E2429A6B525416AEDBF5A0DE6A57A637B39B"
	];

	var gcm_aad = [
		"",
		"",
		"",
		"FEEDFACEDEADBEEFFEEDFACEDEADBEEFABADDAD2",
		"FEEDFACEDEADBEEFFEEDFACEDEADBEEFABADDAD2",
		"",
		"FEEDFACEDEADBEEFFEEDFACEDEADBEEFABADDAD2",
		"",
		"",
		"",
		"FEEDFACEDEADBEEFFEEDFACEDEADBEEFABADDAD2",
		"FEEDFACEDEADBEEFFEEDFACEDEADBEEFABADDAD2",
		"FEEDFACEDEADBEEFFEEDFACEDEADBEEFABADDAD2",
		"",
		"",
		"",
		"FEEDFACEDEADBEEFFEEDFACEDEADBEEFABADDAD2",
		"FEEDFACEDEADBEEFFEEDFACEDEADBEEFABADDAD2",
		"FEEDFACEDEADBEEFFEEDFACEDEADBEEFABADDAD2"
	];

	var gcm_plaintexts = [
		"",
		"00000000000000000000000000000000",
		"D9313225F88406E5A55909C5AFF5269A86A7A9531534F7DA2E4C303D8A318A721C3C0C95956809532FCF0E2449A6B525B16AEDF5AA0DE657BA637B391AAFD255",
		"D9313225F88406E5A55909C5AFF5269A86A7A9531534F7DA2E4C303D8A318A721C3C0C95956809532FCF0E2449A6B525B16AEDF5AA0DE657BA637B39",
		"D9313225F88406E5A55909C5AFF5269A86A7A9531534F7DA2E4C303D8A318A721C3C0C95956809532FCF0E2449A6B525B16AEDF5AA0DE657BA637B39",
		"D9313225F88406E5A55909C5AFF5269A86A7A9531534F7DA2E4C303D8A318A721C3C0C95956809532FCF0E2449A6B525B16AEDF5AA0DE657BA637B391AAFD255",
		"D9313225F88406E5A55909C5AFF5269A86A7A9531534F7DA2E4C303D8A318A721C3C0C95956809532FCF0E2449A6B525B16AEDF5AA0DE657BA637B39",
		"",
		"00000000000000000000000000000000",
		"D9313225F88406E5A55909C5AFF5269A86A7A9531534F7DA2E4C303D8A318A721C3C0C95956809532FCF0E2449A6B525B16AEDF5AA0DE657BA637B391AAFD255",
		"D9313225F88406E5A55909C5AFF5269A86A7A9531534F7DA2E4C303D8A318A721C3C0C95956809532FCF0E2449A6B525B16AEDF5AA0DE657BA637B39",
		"D9313225F88406E5A55909C5AFF5269A86A7A9531534F7DA2E4C303D8A318A721C3C0C95956809532FCF0E2449A6B525B16AEDF5AA0DE657BA637B39",
		"D9313225F88406E5A55909C5AFF5269A86A7A9531534F7DA2E4C303D8A318A721C3C0C95956809532FCF0E2449A6B525B16AEDF5AA0DE657BA637B39",
		"",
		"00000000000000000000000000000000",
		"D9313225F88406E5A55909C5AFF5269A86A7A9531534F7DA2E4C303D8A318A721C3C0C95956809532FCF0E2449A6B525B16AEDF5AA0DE657BA637B391AAFD255",
		"D9313225F88406E5A55909C5AFF5269A86A7A9531534F7DA2E4C303D8A318A721C3C0C95956809532FCF0E2449A6B525B16AEDF5AA0DE657BA637B39",
		"D9313225F88406E5A55909C5AFF5269A86A7A9531534F7DA2E4C303D8A318A721C3C0C95956809532FCF0E2449A6B525B16AEDF5AA0DE657BA637B39",
		"D9313225F88406E5A55909C5AFF5269A86A7A9531534F7DA2E4C303D8A318A721C3C0C95956809532FCF0E2449A6B525B16AEDF5AA0DE657BA637B39"
	];

	var gcm_ciphers = [
		"58E2FCCEFA7E3061367F1D57A4E7455A",
		"0388DACE60B6A392F328C2B971B2FE78AB6E47D42CEC13BDF53A67B21257BDDF",
		"42831EC2217774244B7221B784D0D49CE3AA212F2C02A4E035C17E2329ACA12E21D514B25466931C7D8F6A5AAC84AA051BA30B396A0AAC973D58E091473F59854D5C2AF327CD64A62CF35ABD2BA6FAB4",
		"42831EC2217774244B7221B784D0D49CE3AA212F2C02A4E035C17E2329ACA12E21D514B25466931C7D8F6A5AAC84AA051BA30B396A0AAC973D58E0915BC94FBC3221A5DB94FAE95AE7121A47",
		"61353B4C2806934A777FF51FA22A4755699B2A714FCDC6F83766E5F97B6C742373806900E49F24B22B097544D4896B424989B5E1EBAC0F07C23F45983612D2E79E3B0785561BE14AACA2FCCB",
		"8CE24998625615B603A033ACA13FB894BE9112A5C3A211A8BA262A3CCA7E2CA701E4A9A4FBA43C90CCDCB281D48C7C6FD62875D2ACA417034C34AEE58E18948EFA56E4DC75CB478B582BD7089386E617",
		"8CE24998625615B603A033ACA13FB894BE9112A5C3A211A8BA262A3CCA7E2CA701E4A9A4FBA43C90CCDCB281D48C7C6FD62875D2ACA417034C34AEE5619CC5AEFFFE0BFA462AF43C1699D050",
		"CD33B28AC773F74BA00ED1F312572435",
		"98E7247C07F0FE411C267E4384B0F6002FF58D80033927AB8EF4D4587514F0FB",
		"3980CA0B3C00E841EB06FAC4872A2757859E1CEAA6EFD984628593B40CA1E19C7D773D00C144C525AC619D18C84A3F4718E2448B2FE324D9CCDA2710ACADE2569924A7C8587336BFB118024DB8674A14",
		"3980CA0B3C00E841EB06FAC4872A2757859E1CEAA6EFD984628593B40CA1E19C7D773D00C144C525AC619D18C84A3F4718E2448B2FE324D9CCDA27102519498E80F1478F37BA55BD6D27618C",
		"0F10F599AE14A154ED24B36E25324DB8C566632EF2BBB34F8347280FC4507057FDDC29DF9A471F75C66541D4D4DAD1C9E93A19A58E8B473FA0F062F765DCC57FCF623A24094FCCA40D3533F8",
		"D27E88681CE3243C4830165A8FDCF9FF1DE9A1D8E6B447EF6EF7B79828666E4581E79012AF34DDD9E2F037589B292DB3E67C036745FA22E7E9B7373BDCF566FF291C25BBB8568FC3D376A6D9",
		"530F8AFBC74536B9A963B4F1C4CB738B",
		"CEA7403D4D606B6E074EC5D3BAF39D18D0D1C8A799996BF0265B98B5D48AB919",
		"522DC1F099567D07F47F37A32A84427D643A8CDCBFE5C0C97598A2BD2555D1AA8CB08E48590DBB3DA7B08B1056828838C5F61E6393BA7A0ABCC9F662898015ADB094DAC5D93471BDEC1A502270E3CC6C",
		"522DC1F099567D07F47F37A32A84427D643A8CDCBFE5C0C97598A2BD2555D1AA8CB08E48590DBB3DA7B08B1056828838C5F61E6393BA7A0ABCC9F66276FC6ECE0F4E1768CDDF8853BB2D551B",
		"C3762DF1CA787D32AE47C13BF19844CBAF1AE14D0B976AFAC52FF7D79BBA9DE0FEB582D33934A4F0954CC2363BC73F7862AC430E64ABE499F47C9B1F3A337DBF46A792C45E454913FE2EA8F2",
		"5A8DEF2F0C9E53F1F75D7853659E2A20EEB2B22AAFDE6419A058AB4F6F746BF40FC0C3B780F244452DA3EBF1C5D82CDEA2418997200EF82E44AE7E3FA44A8266EE1C8EB0C8B5D4CF5AE9F19A"
	];

	// SIV test vectors from RFC 5297
	var siv_keys = [
		"FFFEFDFCFBFAF9F8F7F6F5F4F3F2F1F0F0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF",
		"7F7E7D7C7B7A79787776757473727170404142434445464748494A4B4C4D4E4F",
		"0000000000000000000000000000000000000000000000000000000000000000",
		"FFFEFDFCFBFAF9F8F7F6F5F4F3F2F1F0F0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF"
	];

	var siv_plaintexts = [
		"112233445566778899AABBCCDDEE",
		"7468697320697320736F6D6520706C61696E7465787420746F20656E6372797074207573696E67205349562D414553",
		"11111111111111111111111111111111",
		"112233445566778899AABBCCDDEE"
	];

	var siv_aad = [
		["101112131415161718191A1B1C1D1E1F2021222324252627"],
		[
			"00112233445566778899AABBCCDDEEFFDEADDADADEADDADAFFEEDDCCBBAA99887766554433221100",
			"102030405060708090A0",
			"09F911029D74E35BD84156C5635688C0"
		],
		["00000000000000000000000000000000"],
		[]
	];

	var siv_ciphers = [
		"85632D07C6E8F37F950ACD320A2ECC9340C02B9690C4DC04DAEF7F6AFE5C",
		"7BDB6E3B432667EB06F4D14BFF2FBD0FCB900F2FDDBE404326601965C889BF17DBA77CEB094FA663B7A3F748BA8AF829EA64AD544A272E9C485B62A3FD5C0D",
		"F843A7CF007BA2CA6FF568A0EB1E745ECF8FF16D974976E16442065B097C2519",
		"F1C5FDEAC1F15A26779C1501F9FB758827E946C669088AB06DA58C5C831C"
	];

	// GCM-SIV test vectors from RFC 8452
	var gcmsiv_keys = [
		"01000000000000000000000000000000",
		"01000000000000000000000000000000",
		"01000000000000000000000000000000",
		"01000000000000000000000000000000",
		"01000000000000000000000000000000",
		"01000000000000000000000000000000",
		"01000000000000000000000000000000",
		"01000000000000000000000000000000",
		"01000000000000000000000000000000",
		"01000000000000000000000000000000",
		"01000000000000000000000000000000",
		"01000000000000000000000000000000",
		"01000000000000000000000000000000",
		"01000000000000000000000000000000",
		"01000000000000000000000000000000",
		"01000000000000000000000000000000",
		"0100000000000000000000000000000000000000000000000000000000000000",
		"0100000000000000000000000000000000000000000000000000000000000000",
		"0100000000000000000000000000000000000000000000000000000000000000",
		"0100000000000000000000000000000000000000000000000000000000000000",
		"E66021D5EB8E4F4066D4ADB9C33560E4",
		"36864200E0EAF5284D884A0E77D31646",
		"AEDB64A6C590BC84D1A5E269E4B47801",
		"D5CC1FD161320B6920CE07787F86743B",
		"B3FED1473C528B8426A582995929A149",
		"2D4ED87DA44102952EF94B02B805249B",
		"BDE3B2F204D1E9F8B06BC47F9745B3D1",
		"F901CFE8A69615A93FDF7A98CAD48179",
		"0100000000000000000000000000000000000000000000000000000000000000",
		"0100000000000000000000000000000000000000000000000000000000000000",
		"0100000000000000000000000000000000000000000000000000000000000000",
		"0100000000000000000000000000000000000000000000000000000000000000",
		"0100000000000000000000000000000000000000000000000000000000000000",
		"0100000000000000000000000000000000000000000000000000000000000000",
		"0100000000000000000000000000000000000000000000000000000000000000",
		"0100000000000000000000000000000000000000000000000000000000000000",
		"0100000000000000000000000000000000000000000000000000000000000000",
		"0100000000000000000000000000000000000000000000000000000000000000",
		"0100000000000000000000000000000000000000000000000000000000000000",
		"0100000000000000000000000000000000000000000000000000000000000000",
		"0100000000000000000000000000000000000000000000000000000000000000",
		"0100000000000000000000000000000000000000000000000000000000000000",
		"0100000000000000000000000000000000000000000000000000000000000000",
		"0100000000000000000000000000000000000000000000000000000000000000",
		"E66021D5EB8E4F4066D4ADB9C33560E4F46E44BB3DA0015C94F7088736864200",
		"BAE8E37FC83441B16034566B7A806C46BB91C3C5AEDB64A6C590BC84D1A5E269",
		"6545FC880C94A95198874296D5CC1FD161320B6920CE07787F86743B275D1AB3",
		"D1894728B3FED1473C528B8426A582995929A1499E9AD8780C8D63D0AB4149C0",
		"A44102952EF94B02B805249BAC80E6F61455BFAC8308A2D40D8C845117808235",
		"9745B3D1AE06556FB6AA7890BEBC18FE6B3DB4DA3D57AA94842B9803A96E07FB",
		"B18853F68D833640E42A3C02C25B64869E146D7B233987BDDFC240871D7576F7",
		"3C535DE192EAED3822A2FBBE2CA9DFC88255E14A661B8AA82CC54236093BBC23",
		"0000000000000000000000000000000000000000000000000000000000000000",
		"0000000000000000000000000000000000000000000000000000000000000000"
	];

	var gcmsiv_nonces = [
		"030000000000000000000000", "030000000000000000000000", "030000000000000000000000", "030000000000000000000000", "030000000000000000000000",
		"030000000000000000000000", "030000000000000000000000", "030000000000000000000000", "030000000000000000000000", "030000000000000000000000",
		"030000000000000000000000", "030000000000000000000000", "030000000000000000000000", "030000000000000000000000", "030000000000000000000000",
		"030000000000000000000000", "030000000000000000000000", "030000000000000000000000", "030000000000000000000000", "030000000000000000000000",
		"F46E44BB3DA0015C94F70887", "BAE8E37FC83441B16034566B", "AFC0577E34699B9E671FDD4F", "275D1AB32F6D1F0434D8848C", "9E9AD8780C8D63D0AB4149C0",
		"AC80E6F61455BFAC8308A2D4", "AE06556FB6AA7890BEBC18FE", "6245709FB18853F68D833640", "030000000000000000000000", "030000000000000000000000",
		"030000000000000000000000", "030000000000000000000000", "030000000000000000000000", "030000000000000000000000", "030000000000000000000000",
		"030000000000000000000000", "030000000000000000000000", "030000000000000000000000", "030000000000000000000000", "030000000000000000000000",
		"030000000000000000000000", "030000000000000000000000", "030000000000000000000000", "030000000000000000000000", "E0EAF5284D884A0E77D31646",
		"E4B47801AFC0577E34699B9E", "2F6D1F0434D8848C1177441F", "9F572C614B4745914474E7C7", "5C9E940FEA2F582950A70D5A", "6DE71860F762EBFBD08284E4",
		"028EC6EB5EA7E298342A94D4", "688089E55540DB1872504E1C", "000000000000000000000000", "000000000000000000000000"
	];

	var gcmsiv_aad = [
		"",
		"",
		"",
		"",
		"",
		"",
		"",
		"01",
		"01",
		"01",
		"01",
		"01",
		"01",
		"010000000000000000000000",
		"010000000000000000000000000000000200",
		"0100000000000000000000000000000002000000",
		"",
		"01",
		"01",
		"01",
		"",
		"46BB91C3C5",
		"FC880C94A95198874296",
		"046787F3EA22C127AAF195D1894728",
		"C9882E5386FD9F92EC489C8FDE2BE2CF97E74E93",
		"2950A70D5A1DB2316FD568378DA107B52B0DA55210CC1C1B0A",
		"1860F762EBFBD08284E421702DE0DE18BAA9C9596291B08466F37DE21C7F",
		"7576F7028EC6EB5EA7E298342A94D4B202B370EF9768EC6561C4FE6B7E7296FA859C21",
		"",
		"",
		"",
		"",
		"",
		"",
		"",
		"01",
		"01",
		"01",
		"01",
		"01",
		"01",
		"010000000000000000000000",
		"010000000000000000000000000000000200",
		"0100000000000000000000000000000002000000",
		"",
		"4FBDC66F14",
		"6787F3EA22C127AAF195",
		"489C8FDE2BE2CF97E74E932D4ED87D",
		"0DA55210CC1C1B0ABDE3B2F204D1E9F8B06BC47F",
		"F37DE21C7FF901CFE8A69615A93FDF7A98CAD481796245709F",
		"9C2159058B1F0FE91433A5BDC20E214EAB7FECEF4454A10EF0657DF21AC7",
		"734320CCC9D9BBBB19CB81B2AF4ECBC3E72834321F7AA0F70B7282B4F33DF23F167541",
		"",
		""
	];

	var gcmsiv_plaintexts = [
		"",
		"0100000000000000",
		"010000000000000000000000",
		"01000000000000000000000000000000",
		"0100000000000000000000000000000002000000000000000000000000000000",
		"010000000000000000000000000000000200000000000000000000000000000003000000000000000000000000000000",
		"01000000000000000000000000000000020000000000000000000000000000000300000000000000000000000000000004000000000000000000000000000000",
		"0200000000000000",
		"020000000000000000000000",
		"02000000000000000000000000000000",
		"0200000000000000000000000000000003000000000000000000000000000000",
		"020000000000000000000000000000000300000000000000000000000000000004000000000000000000000000000000",
		"02000000000000000000000000000000030000000000000000000000000000000400000000000000000000000000000005000000000000000000000000000000",
		"02000000",
		"0300000000000000000000000000000004000000",
		"030000000000000000000000000000000400",
		"01000000000000000000000000000000020000000000000000000000000000000300000000000000000000000000000004000000000000000000000000000000",
		"0200000000000000",
		"020000000000000000000000",
		"02000000000000000000000000000000",
		"",
		"7A806C",
		"BDC66F146545",
		"1177441F195495860F",
		"9F572C614B4745914474E7C7",
		"0D8C8451178082355C9E940FEA2F58",
		"6B3DB4DA3D57AA94842B9803A96E07FB6DE7",
		"E42A3C02C25B64869E146D7B233987BDDFC240871D",
		"",
		"0100000000000000",
		"010000000000000000000000",
		"01000000000000000000000000000000",
		"0100000000000000000000000000000002000000000000000000000000000000",
		"010000000000000000000000000000000200000000000000000000000000000003000000000000000000000000000000",
		"01000000000000000000000000000000020000000000000000000000000000000300000000000000000000000000000004000000000000000000000000000000",
		"0200000000000000",
		"020000000000000000000000",
		"02000000000000000000000000000000",
		"0200000000000000000000000000000003000000000000000000000000000000",
		"020000000000000000000000000000000300000000000000000000000000000004000000000000000000000000000000",
		"02000000000000000000000000000000030000000000000000000000000000000400000000000000000000000000000005000000000000000000000000000000",
		"02000000",
		"0300000000000000000000000000000004000000",
		"030000000000000000000000000000000400",
		"",
		"671FDD",
		"195495860F04",
		"C9882E5386FD9F92EC",
		"1DB2316FD568378DA107B52B",
		"21702DE0DE18BAA9C9596291B08466",
		"B202B370EF9768EC6561C4FE6B7E7296FA85",
		"CED532CE4159B035277D4DFBB7DB62968B13CD4EEC",
		"000000000000000000000000000000004DB923DC793EE6497C76DCC03A98E108",
		"EB3640277C7FFD1303C7A542D02D3E4C0000000000000000"
	];

	var gcmsiv_ciphers = [
		"DC20E2D83F25705BB49E439ECA56DE25",
		"B5D839330AC7B786578782FFF6013B815B287C22493A364C",
		"7323EA61D05932260047D942A4978DB357391A0BC4FDEC8B0D106639",
		"743F7C8077AB25F8624E2E948579CF77303AAF90F6FE21199C6068577437A0C4",
		"84E07E62BA83A6585417245D7EC413A9FE427D6315C09B57CE45F2E3936A94451A8E45DCD4578C667CD86847BF6155FF",
		"3FD24CE1F5A67B75BF2351F181A475C7B800A5B4D3DCF70106B1EEA82FA1D64DF42BF7226122FA92E17A40EEAAC1201B5E6E311DBF395D35B0FE39C2714388F8",
		"2433668F1058190F6D43E360F4F35CD8E475127CFCA7028EA8AB5C20F7AB2AF02516A2BDCBC08D521BE37FF28C152BBA36697F25B4CD169C6590D1DD39566D3F8A263DD317AA88D56BDF3936DBA75BB8",
		"1E6DABA35669F4273B0A1A2560969CDF790D99759ABD1508",
		"296C7889FD99F41917F4462008299C5102745AAA3A0C469FAD9E075A",
		"E2B0C5DA79A901C1745F700525CB335B8F8936EC039E4E4BB97EBD8C4457441F",
		"620048EF3C1E73E57E02BB8562C416A319E73E4CAAC8E96A1ECB2933145A1D71E6AF6A7F87287DA059A71684ED3498E1",
		"50C8303EA93925D64090D07BD109DFD9515A5A33431019C17D93465999A8B0053201D723120A8562B838CDFF25BF9D1E6A8CC3865F76897C2E4B245CF31C51F2",
		"2F5C64059DB55EE0FB847ED513003746ACA4E61C711B5DE2E7A77FFD02DA42FEEC601910D3467BB8B36EBBAEBCE5FBA30D36C95F48A3E7980F0E7AC299332A80CDC46AE475563DE037001EF84AE21744",
		"A8FE3E8707EB1F84FB28F8CB73DE8E99E2F48A14",
		"6BB0FECF5DED9B77F902C7D5DA236A4391DD029724AFC9805E976F451E6D87F6FE106514",
		"44D0AAF6FB2F1F34ADD5E8064E83E12A2ADABFF9B2EF00FB47920CC72A0C0F13B9FD",
		"C2D5160A1F8683834910ACDAFC41FBB1632D4A353E8B905EC9A5499AC34F96C7E1049EB080883891A4DB8CAAA1F99DD004D80487540735234E3744512C6F90CE112864C269FC0D9D88C61FA47E39AA08",
		"1DE22967237A813291213F267E3B452F02D01AE33E4EC854",
		"163D6F9CC1B346CD453A2E4CC1A4A19AE800941CCDC57CC8413C277F",
		"C91545823CC24F17DBB0E9E807D5EC17B292D28FF61189E8E49F3875EF91AFF7",
		"A4194B79071B01A87D65F706E3949578",
		"AF60EB711BD85BC1E4D3E0A462E074EEA428A8",
		"BB93A3E34D3CD6A9C45545CFC11F03AD743DBA20F966",
		"4F37281F7AD12949D01D02FD0CD174C84FC5DAE2F60F52FD2B",
		"F54673C5DDF710C745641C8BC1DC2F871FB7561DA1286E655E24B7B0",
		"C9FF545E07B88A015F05B274540AA183B3449B9F39552DE99DC214A1190B0B",
		"6298B296E24E8CC35DCE0BED484B7F30D5803E377094F04709F64D7B985310A4DB84",
		"391CC328D484A4F46406181BCD62EFD9B3EE197D052D15506C84A9EDD65E13E9D24A2A6E70",
		"07F5F4169BBF55A8400CD47EA6FD400F",
		"C2EF328E5C71C83B843122130F7364B761E0B97427E3DF28",
		"9AAB2AEB3FAA0A34AEA8E2B18CA50DA9AE6559E48FD10F6E5C9CA17E",
		"85A01B63025BA19B7FD3DDFC033B3E76C9EAC6FA700942702E90862383C6C366",
		"4A6A9DB4C8C6549201B9EDB53006CBA821EC9CF850948A7C86C68AC7539D027FE819E63ABCD020B006A976397632EB5D",
		"C00D121893A9FA603F48CCC1CA3C57CE7499245EA0046DB16C53C7C66FE717E39CF6C748837B61F6EE3ADCEE17534ED5790BC96880A99BA804BD12C0E6A22CC4",
		"C2D5160A1F8683834910ACDAFC41FBB1632D4A353E8B905EC9A5499AC34F96C7E1049EB080883891A4DB8CAAA1F99DD004D80487540735234E3744512C6F90CE112864C269FC0D9D88C61FA47E39AA08",
		"1DE22967237A813291213F267E3B452F02D01AE33E4EC854",
		"163D6F9CC1B346CD453A2E4CC1A4A19AE800941CCDC57CC8413C277F",
		"C91545823CC24F17DBB0E9E807D5EC17B292D28FF61189E8E49F3875EF91AFF7",
		"07DAD364BFC2B9DA89116D7BEF6DAAAF6F255510AA654F920AC81B94E8BAD365AEA1BAD12702E1965604374AAB96DBBC",
		"C67A1F0F567A5198AA1FCC8E3F21314336F7F51CA8B1AF61FEAC35A86416FA47FBCA3B5F749CDF564527F2314F42FE2503332742B228C647173616CFD44C54EB",
		"67FD45E126BFB9A79930C43AAD2D36967D3F0E4D217C1E551F59727870BEEFC98CB933A8FCE9DE887B1E40799988DB1FC3F91880ED405B2DD298318858467C895BDE0285037C5DE81E5B570A049B62A0",
		"22B3F4CD1835E517741DFDDCCFA07FA4661B74CF",
		"43DD0163CDB48F9FE3212BF61B201976067F342BB879AD976D8242ACC188AB59CABFE307",
		"462401724B5CE6588D5A54AAE5375513A075CFCDF5042112AA29685C912FC2056543",
		"169FBB2FBF389A995F6390AF22228A62",
		"0EACCB93DA9BB81333AEE0C785B240D319719D",
		"A254DAD4F3F96B62B84DC40C84636A5EC12020EC8C2C",
		"0DF9E308678244C44BC0FD3DC6628DFE55EBB0B9FB2295C8C2",
		"8DBEB9F7255BF5769DD56692404099C2587F64979F21826706D497D5",
		"793576DFA5C0F88729A7ED3C2F1BFFB3080D28F6EBB5D3648CE97BD5BA67FD",
		"857E16A64915A787637687DB4A9519635CDD454FC2A154FEA91F8363A39FEC7D0A49",
		"626660C26EA6612FB17AD91E8E767639EDD6C9FAEE9D6C7029675B89EAF4BA1DED1A286594",
		"F3F80F2CF0CB2DD9C5984FCDA908456CC537703B5BA70324A6793A7BF218D3EAFFFFFFFF000000000000000000000000",
		"18CE4F0B8CB4D0CAC65FEA8F79257B20888E53E72299E56DFFFFFFFF000000000000000000000000"
	];

	public function test_ecb():Void {
		aes_main(ecb_ciphers, Mode.ECB, Padding.NoPadding, null);
	}

	public function test_cbc():Void {
		aes_main(cbc_ciphers, Mode.CBC, Padding.NoPadding, cbc_iv);
	}

	public function test_cfb():Void {
		aes_main(cfb_ciphers, Mode.CFB, Padding.NoPadding, cfb_iv);
	}

	public function test_ofb():Void {
		aes_main(ofb_ciphers, Mode.OFB, Padding.NoPadding, ofb_iv);
	}
	
	public function test_cmac():Void {
		trace("CMAC tests for " + cmac_keys.length + " test vectors");
		var time = Timer.stamp();

		for (i in 0...cmac_keys.length) {
			var key = Bytes.ofHex(cmac_keys[i]);
			var msg = (cmac_messages[i] == "") ? Bytes.alloc(0) : Bytes.ofHex(cmac_messages[i]);
			var expected = cmac_results[i];
			
			var result = CMAC.calculate(msg, key);
			eq(result.toHex().toUpperCase(), expected);
			
			var valid = CMAC.verify(msg, Bytes.ofHex(expected), key);
			eq(valid, true);
		}

		time = Timer.stamp() - time;
		trace("Finished CMAC: " + time + " seconds");
	}

	public function test_ccm():Void {
		trace("CCM tests for " + ccm_keys.length + " test vectors");
		var time = Timer.stamp();

		var aes:Aes = new Aes();

		for (i in 0...ccm_keys.length) {
			if (ccm_ciphers[i] == "") continue; // Skip incomplete test vectors
			
			var key = Bytes.ofHex(ccm_keys[i]);
			var nonce = Bytes.ofHex(ccm_nonces[i]);
			var aad = Bytes.ofHex(ccm_aad[i]);
			var plaintext = Bytes.ofHex(ccm_plaintexts[i]);
			var expected = ccm_ciphers[i];
			var tagLen = ccm_tag_lengths[i];
			
			aes.init(key, nonce);
			var result = aes.encrypt(Mode.CCM, plaintext, aad, tagLen);
			eq(result.toHex().toUpperCase(), expected);
			
			var decrypted = aes.decrypt(Mode.CCM, result, aad, tagLen);
			eq(decrypted.toHex().toUpperCase(), plaintext.toHex().toUpperCase());
		}

		time = Timer.stamp() - time;
		trace("Finished CCM: " + time + " seconds");
	}

	public function test_gcm():Void {
		trace("GCM tests for " + gcm_keys.length + " test vectors");
		var time = Timer.stamp();

		var aes:Aes = new Aes();

		for (i in 0...gcm_keys.length) {
			if (gcm_ciphers[i] == "") continue; // Skip incomplete test vectors
			
			var key = Bytes.ofHex(gcm_keys[i]);
			var iv = Bytes.ofHex(gcm_ivs[i]);
			var aad = (gcm_aad[i] == "") ? Bytes.alloc(0) : Bytes.ofHex(gcm_aad[i]);
			var plaintext = (gcm_plaintexts[i] == "") ? Bytes.alloc(0) : Bytes.ofHex(gcm_plaintexts[i]);
			var expected = gcm_ciphers[i];
			
			aes.init(key, iv);
			var result = aes.encrypt(Mode.GCM, plaintext, aad, 16);
			eq(result.toHex().toUpperCase(), expected);
			
			if (plaintext.length > 0) {
				var decrypted = aes.decrypt(Mode.GCM, result, aad, 16);
				eq(decrypted.toHex().toUpperCase(), plaintext.toHex().toUpperCase());
			}
		}

		time = Timer.stamp() - time;
		trace("Finished GCM: " + time + " seconds");
	}

	public function test_siv():Void {
		trace("SIV tests for " + siv_keys.length + " test vectors");
		var time = Timer.stamp();

		var aes:Aes = new Aes();

		for (i in 0...siv_keys.length) {
			if (siv_ciphers[i] == "") continue; // Skip incomplete test vectors
			
			var key = Bytes.ofHex(siv_keys[i]);
			var plaintext = (siv_plaintexts[i] == "") ? Bytes.alloc(0) : Bytes.ofHex(siv_plaintexts[i]);
			var aad = [];
			for (aadHex in siv_aad[i]) {
				aad.push(Bytes.ofHex(aadHex));
			}
			var expected = siv_ciphers[i];
			
			aes.init(key, null);
			var result = aes.encrypt(Mode.SIV, plaintext, aad);
			eq(result.toHex().toUpperCase(), expected);
			
			var decrypted = aes.decrypt(Mode.SIV, result, aad);
			eq(decrypted.toHex().toUpperCase(), plaintext.toHex().toUpperCase());
		}

		time = Timer.stamp() - time;
		trace("Finished SIV: " + time + " seconds");
	}

	public function test_gcmsiv():Void {
		trace("GCM-SIV tests for " + gcmsiv_keys.length + " test vectors");
		var time = Timer.stamp();

		var aes:Aes = new Aes();

		for (i in 0...gcmsiv_keys.length) {
			if (gcmsiv_ciphers[i] == "") continue; // Skip incomplete test vectors
			
			var key = Bytes.ofHex(gcmsiv_keys[i]);
			var nonce = Bytes.ofHex(gcmsiv_nonces[i]);
			var aad = (gcmsiv_aad[i] == "") ? Bytes.alloc(0) : Bytes.ofHex(gcmsiv_aad[i]);
			var plaintext = (gcmsiv_plaintexts[i] == "") ? Bytes.alloc(0) : Bytes.ofHex(gcmsiv_plaintexts[i]);
			var expected = gcmsiv_ciphers[i];
			
			aes.init(key, nonce);
			var result = aes.encrypt(Mode.GCMSIV, plaintext, aad);
			eq(result.toHex().toUpperCase(), expected);
			
			var decrypted = aes.decrypt(Mode.GCMSIV, result, aad);
			eq(decrypted.toHex().toUpperCase(), plaintext.toHex().toUpperCase());
		}

		time = Timer.stamp() - time;
		trace("Finished GCM-SIV: " + time + " seconds");
	}

	private function aes_main(ciphers:Array<String> = null, cipherMode:Mode = Mode.ECB, padding:Padding = Padding.NoPadding,
			ivTable:Array<String> = null):Void {
		if (ciphers != null) {
			trace("AES with " + cipherMode + " mode for " + keys.length + " keys");
			var time = Timer.stamp();

			var aes:Aes = new Aes();

			for (i in 0...keys.length) {
				var key = Bytes.ofHex(keys[i]);
				var text = Bytes.ofHex(plainText[i]);
				var iv:Bytes = (ivTable == null) ? null : Bytes.ofHex(ivTable[i]);
				aes.init(key, iv);
				var enc = aes.encrypt(cipherMode, text, padding);
				eq(enc.toHex().toUpperCase(), ciphers[i]);
				var decr = aes.decrypt(cipherMode, enc, padding);
				eq(decr.toHex().toUpperCase(), plainText[i]);
			}

			time = Timer.stamp() - time;
			trace("Finished : " + time + " seconds");
		}
	}
}
